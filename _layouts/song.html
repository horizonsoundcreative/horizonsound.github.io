---
layout: default
---

{% assign current_song = page %}
{% assign url = current_song.url %}
{% assign meta = site.data.music.songs | where: "url", url | first %}

{%- comment -%}
BUILD PLAYLIST FOR CAROUSEL (old system)
{%- endcomment -%}
{% assign related = site.data.music.songs | where: "primary_playlist", meta.primary_playlist %}
{% assign related_public = related | where: "videostatus", "Public" %}
{% assign sorted_by_sequence = related_public | sort: "sequence" %}
{% assign first_item = sorted_by_sequence | first %}

{% if first_item.sequence %}
  {% assign playlist_sorted = sorted_by_sequence %}
{% else %}
  {% assign playlist_sorted = related_public | sort: "title" %}
{% endif %}

<main>

  <!-- DEBUG BLOCK -->
{% if site.debug %}
<div class="debug-block">
  <pre style="background:#111; color:#0ff; padding:1rem; margin:1rem 0; white-space:pre-wrap;">

SONG PAGE DEBUG
==============================

PAGE OBJECT
-----------
page.url:          {{ current_song.url }}
page.title:        {{ current_song.title }}
page.song_id:      {{ current_song.song_id }}
page.youtube_id:   {{ current_song.youtube_id }}

META OBJECT (from music.yml)
----------------------------
{{ meta | jsonify }}

RESOLVED VALUES
---------------
resolved.title:     {{ current_song.title | default: meta.title }}
resolved.youtube_id: {{ current_song.youtube_id | default: meta.youtube_id }}
resolved.image:      {{ meta.image }}
resolved.primary_playlist: {{ meta.primary_playlist }}

PLAYLIST SORTED (final list for carousel)
-----------------------------------------
{{ playlist_sorted | jsonify }}

  </pre>
</div>
{% endif %}

  <!-- SONG TITLE -->
  <section class="song-header">
    <h2 class="section-header">
      {{ current_song.title | default: meta.title }}
    </h2>
    {% if current_song.subtitle %}
      <p class="song-subtitle">{{ current_song.subtitle }}</p>
    {% endif %}
  </section>

  <!-- EMBED SECTION (Pulled from embed.html include) -->
  {% assign resolved_youtube_id = current_song.youtube_id | default: meta.youtube_id %}
  {% include embed.html youtube_id=resolved_youtube_id %}
  
  <!-- CAROUSEL (old structure, old CSS) -->
  <script>
    window.allSongs = {{ playlist_with_ids | jsonify }};
  </script>
  {% include carousel.html playlist=playlist_sorted %}
  
  <!-- ABOUT SECTION (Pulled from about.html include) -->
  {% include about.html about=current_song.about %}

  <!-- LYRICS SECTION (Pulled from lyrics.html include) -->
  {% include lyrics.html lyrics=current_song.lyrics %}
  
</main>

<!-- ORIGINAL SIMPLE CAROUSEL JS -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const strip = document.querySelector(".horizontal-strip");
  const left = document.querySelector(".left-arrow");
  const right = document.querySelector(".right-arrow");

  if (!strip || !left || !right) return;

  left.addEventListener("click", () => {
    strip.scrollBy({ left: -300, behavior: "smooth" });
  });

  right.addEventListener("click", () => {
    strip.scrollBy({ left: 300, behavior: "smooth" });
  });
});
</script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const tiles = document.querySelectorAll(".playlist-tile");
  const iframe = document.querySelector(".video-wrapper iframe");

  if (!tiles.length || !iframe) return;

  tiles.forEach(tile => {
    tile.addEventListener("click", () => {
      console.log("TILE CLICKED:", tile);
  
      const songId = tile.dataset.song;
      console.log("SONG ID:", songId);
  
      console.log("window.allSongs:", window.allSongs);
  
      const song = window.allSongs?.find(s => s.song_id === songId);
      console.log("MATCHED SONG:", song);
  
      if (!song) {
        console.warn("NO MATCHING SONG FOUND FOR:", songId);
        return;
      }
  
      console.log("UPDATING EMBED TO:", song.youtube_id);
  
      iframe.src = "https://www.youtube.com/embed/" + song.youtube_id;
  
      document.querySelectorAll(".playlist-tile").forEach(t => t.classList.remove("active-tile"));
      tile.classList.add("active-tile");
  
      tile.scrollIntoView({ behavior: "smooth", inline: "center", block: "nearest" });
    });
  });
});
</script>

