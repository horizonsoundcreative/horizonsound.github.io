---
layout: default
---

{% assign current_song = page %}

<!-- ============================
     DEBUG BLOCK â€” SONG PAGE
============================= -->
<div style="background:#111; color:#0ff; padding:1rem; margin:1rem 0; font-family:monospace; white-space:pre-wrap;">

<strong>SONG PAGE DEBUG</strong>

current_song.song_id:
[{{ current_song.song_id }}]

current_song.url:
[{{ current_song.url }}]

--- metadata from music.yml ---
{% assign url = current_song.url %}
{% assign meta = site.data.music.songs | where: "url", url | first %}

meta.primary_playlist:
[{{ meta.primary_playlist }}]

meta.sequence:
[{{ meta.sequence }}]

meta.videostatus:
[{{ meta.videostatus }}]

meta.youtube_id:
[{{ meta.youtube_id }}]

meta.image:
[{{ meta.image }}]

--- related songs (raw from music.yml) ---
{% assign related = site.data.music.songs | where: "primary_playlist", meta.primary_playlist %}
{% for s in related %}
- title: "{{ s.title }}"
  url: "{{ s.url }}"
  sequence: "{{ s.sequence }}"
  videostatus: "{{ s.videostatus }}"
{% endfor %}

--- related PUBLIC songs ---
{% assign related_public = related | where: "videostatus", "Public" %}
{% for s in related_public %}
- "{{ s.title }}"
{% endfor %}

--- playlist_sorted (final order) ---
{% assign sorted_by_sequence = related_public | sort: "sequence" %}
{% assign first_item = sorted_by_sequence | first %}

{% if first_item.sequence %}
  {% assign playlist_sorted = sorted_by_sequence %}
{% else %}
  {% assign playlist_sorted = related_public | sort: "title" %}
{% endif %}

{% for s in playlist_sorted %}
- "{{ s.title }}" ({{ s.url }})
{% endfor %}

</div>

<main>

  <!-- SONG TITLE + SUBTITLE -->
  <section class="song-header">
    <h2 class="section-header">{{ current_song.title }}</h2>
    {% if current_song.subtitle %}
      <p class="song-subtitle">{{ current_song.subtitle }}</p>
    {% endif %}
  </section>

  <!-- UNIFIED VIEWER -->
  <div id="playlist-player" class="playlist-player">
    <iframe
      id="playlist-iframe"
      width="100%"
      height="360"
      src="https://www.youtube.com/embed/{{ meta.youtube_id }}"
      frameborder="0"
      allowfullscreen>
    </iframe>
  </div>

  <!-- UNIFIED DETAILS (title, description, lyrics) -->
  <div id="song-details" class="song-details">
    <h2 id="song-title">{{ current_song.title }}</h2>
    <p id="song-description">{{ current_song.about }}</p>
    <div id="song-lyrics">
      {{ current_song.lyrics | markdownify }}
    </div>
  </div>

  <!-- UNIFIED CAROUSEL -->
  {% if meta.primary_playlist %}
    <div class="carousel-wrapper">
      {% include carousel.html 
           songs=playlist_sorted 
           current=current_song 
           public_only=true 
           mode="song" 
      %}
    </div>
  {% endif %}

</main>

