---
layout: default
---

{% assign current_song = page %}
{% assign url = current_song.url %}
{% assign meta = site.data.music.songs | where: "url", url | first %}

{%- comment -%}
BUILD PLAYLIST FOR CAROUSEL (old system)
{%- endcomment -%}
{% assign related = site.data.music.songs | where: "primary_playlist", meta.primary_playlist %}
{% assign related_public = related | where: "videostatus", "Public" %}
{% assign sorted_by_sequence = related_public | sort: "sequence" %}
{% assign first_item = sorted_by_sequence | first %}

{% if first_item.sequence %}
  {% assign playlist_sorted = sorted_by_sequence %}
{% else %}
  {% assign playlist_sorted = related_public | sort: "title" %}
{% endif %}

<main>

  <!-- DEBUG BLOCK -->
{% if site.debug %}
<div class="debug-block">
  <pre style="background:#111; color:#0ff; padding:1rem; margin:1rem 0; white-space:pre-wrap;">

SONG PAGE DEBUG
==============================

PAGE OBJECT
-----------
page.url:          {{ current_song.url }}
page.title:        {{ current_song.title }}
page.song_id:      {{ current_song.song_id }}
page.youtube_id:   {{ current_song.youtube_id }}

META OBJECT (from music.yml)
----------------------------
{{ meta | jsonify }}

RESOLVED VALUES
---------------
resolved.title:     {{ current_song.title | default: meta.title }}
resolved.youtube_id: {{ current_song.youtube_id | default: meta.youtube_id }}
resolved.image:      {{ meta.image }}
resolved.primary_playlist: {{ meta.primary_playlist }}

PLAYLIST SORTED (final list for carousel)
-----------------------------------------
{{ playlist_sorted | jsonify }}

  </pre>
</div>
{% endif %}

  <!-- SONG TITLE -->
  <section class="song-header">
    <h2 class="section-header">
      {{ current_song.title | default: meta.title }}
    </h2>
    {% if current_song.subtitle %}
      <p class="song-subtitle">{{ current_song.subtitle }}</p>
    {% endif %}
  </section>

  <!-- EMBED SECTION (Pulled from embed.html include) -->
  {% assign resolved_youtube_id = current_song.youtube_id | default: meta.youtube_id %}
  {% include embed.html youtube_id=current_song.youtube_id | default: meta.youtube_id %}
  {% include embed.html youtube_id=resolved_youtube_id %}
  
  <!-- CAROUSEL (old structure, old CSS) -->
  {% if meta.primary_playlist %}
    <div class="playlist-carousel">

      <!-- LEFT ARROW -->
      <button class="carousel-arrow left-arrow">‹</button>

      <!-- SCROLLING STRIP -->
      <div class="horizontal-strip">
        {% for item in playlist_sorted %}
          {% assign song_id = item.url | split: "/" | last %}
          {% assign song = site.songs | where: "song_id", song_id | first %}
          {% if song %}
            <div class="playlist-tile" data-song="{{ song.song_id }}">
              <img src="{{ item.image }}" alt="{{ song.title }}">
              <h3 class="tile-title">{{ song.title }}</h3>
            </div>
          {% endif %}
        {% endfor %}
      </div>

      <!-- RIGHT ARROW -->
      <button class="carousel-arrow right-arrow">›</button>

    </div>
  {% endif %}

  <!-- ABOUT SECTION (Pulled from about.html include) -->
  {% include about.html about=current_song.about %}

  <!-- LYRICS SECTION (Pulled from lyrics.html include) -->
  {% include lyrics.html lyrics=current_song.lyrics %}
  
</main>

<!-- ORIGINAL SIMPLE CAROUSEL JS -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const strip = document.querySelector(".horizontal-strip");
  const left = document.querySelector(".left-arrow");
  const right = document.querySelector(".right-arrow");

  if (!strip || !left || !right) return;

  left.addEventListener("click", () => {
    strip.scrollBy({ left: -300, behavior: "smooth" });
  });

  right.addEventListener("click", () => {
    strip.scrollBy({ left: 300, behavior: "smooth" });
  });
});
</script>
