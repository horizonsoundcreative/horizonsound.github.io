---
layout: default
---

{% assign playlist = page %}
{% assign all_songs = site.songs %}

{% assign first_song_id = playlist.songs | first %}
{% assign first_song = all_songs | where: "song_id", first_song_id | first %}
{% assign first_url = "/music/" | append: first_song.song_id | append: "/" %}
{% assign first_meta = site.data.music.songs | where: "url", first_url | first %}

{% if site.debug %}
<div class="debug-block">
<pre style="background:#111; color:#0ff; padding:1rem; margin:1rem 0; white-space:pre-wrap;">

PLAYLIST PAGE DEBUG
==============================

playlist page object:
{{ playlist | jsonify }}

playlist.songs (raw list passed to carousel):
{{ playlist.songs | jsonify }}

first_song_id:
{{ first_song_id }}

first_song (from site.songs):
{{ first_song | jsonify }}

first_url:
{{ first_url }}

first_meta (from music.yml):
{{ first_meta | jsonify }}

</pre>
</div>
{% endif %}

<div class="playlist-page">

  <!-- ============================
       PLAYLIST TITLE + NARRATIVE
  ============================= -->
  <h1 class="playlist-title">{{ playlist.title }}</h1>

  {% if playlist.description %}
    <p class="playlist-narrative">{{ playlist.description }}</p>
  {% endif %}

  <!-- ============================
       ACTIVE YOUTUBE PLAYER
  ============================= -->
  <div id="playlist-player" class="playlist-player">
    <iframe
      id="playlist-iframe"
      width="100%"
      height="360"
      src="https://www.youtube.com/embed/{{ first_meta.youtube_id }}"
      frameborder="0"
      allowfullscreen>
    </iframe>
  </div>

  <!-- ============================
       PLAYLIST CAROUSEL
  ============================= -->
  {% include carousel.html songs=playlist.songs current=first_song mode="playlist" public_only=true %}

  <!-- ============================
       DYNAMIC TRACK DETAILS
  ============================= -->
  <div id="song-details" class="song-details">
    <h2 id="song-title">{{ first_song.title }}</h2>
    <p id="song-description">{{ first_song.about }}</p>
    <div id="song-lyrics">
      {{ first_song.lyrics | markdownify }}
    </div>
  </div>

</div>

<!-- ============================
     SCRIPT: DYNAMIC TRACK SWITCHING
============================= -->
<script>
document.addEventListener("DOMContentLoaded", function () {

  /* -----------------------------------------
     SAFE, ESCAPED SONG DATA
  ----------------------------------------- */
  const allSongs = [
    {% for song in site.songs %}
      {
        song_id: "{{ song.song_id }}",
        title: {{ song.title | jsonify }},
        {% assign url = "/music/" | append: song.song_id | append: "/" %}
        {% assign meta = site.data.music.songs | where: "url", url | first %}
        youtube_id: "{{ meta.youtube_id }}",
        image: "{{ meta.image }}",
        description: {{ song.about | jsonify }},
        lyrics: {{ song.lyrics | jsonify }},
        videostatus: "{{ meta.videostatus }}"
      }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ];

  const playlistSongs = {{ playlist.songs | jsonify }};

  const iframe = document.getElementById("playlist-iframe");
  const titleEl = document.getElementById("song-title");
  const descEl = document.getElementById("song-description");
  const lyricsEl = document.getElementById("song-lyrics");

  const tiles = document.querySelectorAll(".playlist-tile");

  function getSongData(id) {
    return allSongs.find(s => s.song_id === id);
  }

  /* -----------------------------------------
     TILE CLICK HANDLER
  ----------------------------------------- */
  tiles.forEach(tile => {
    tile.addEventListener("click", () => {
      const songId = tile.dataset.song;
      const song = getSongData(songId);

      if (!song) return;

      tiles.forEach(t => t.classList.remove("active"));
      tile.classList.add("active");

      iframe.src = "https://www.youtube.com/embed/" + song.youtube_id;
      titleEl.textContent = song.title;
      descEl.textContent = song.description || "";
      lyricsEl.innerHTML = song.lyrics || "";

      document.getElementById("song-details").scrollIntoView({
        behavior: "smooth",
        block: "start"
      });
    });
  });

  /* -----------------------------------------
     ARROW SCROLLING
  ----------------------------------------- */
  const strip = document.getElementById("carousel-strip");
  const left = document.getElementById("carousel-left");
  const right = document.getElementById("carousel-right");

  left.addEventListener("click", () => {
    strip.scrollBy({ left: -300, behavior: "smooth" });
  });

  right.addEventListener("click", () => {
    strip.scrollBy({ left: 300, behavior: "smooth" });
  });

});
</script>
