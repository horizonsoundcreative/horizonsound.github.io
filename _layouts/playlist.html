---
layout: default
---

{% comment %}
  1. Load the playlist entry from playlists.yml
{% endcomment %}
{% assign playlist = site.data.playlists | where: "playlist_id", page.playlist_id | first %}

<main class="playlist-page">
  <script>
    window.isPlaylistPage = true;
  </script>

  {% if site.debug %}
  <div class="debug-block">
    <pre style="background:#111; color:#0ff; padding:1rem; white-space:pre-wrap;">
PLAYLIST PAGE DEBUG
==============================

page.playlist_id: {{ page.playlist_id }}

PLAYLIST YAML ENTRY:
{{ playlist | jsonify }}

SONG IDS FROM PLAYLIST:
{{ playlist.songs | jsonify }}

    </pre>
  </div>
  {% endif %}

  <!-- PLAYLIST HEADER -->
  <section class="playlist-header">
    <h2 class="section-header">{{ playlist.title }}</h2>
    {% if playlist.description %}
      <p class="playlist-description">{{ playlist.description }}</p>
    {% endif %}
  </section>

  {% comment %}
    2. Build the list of songs for this playlist
  {% endcomment %}
  {% assign playlist_songs = "" | split: "" %}

  {% for sid in playlist.songs %}
    {% assign expected_song = site.data.music.songs | where: "song_id", sid | first %}
    {% if expected_song and expected_song.videostatus == "Public" %}
      {% assign playlist_songs = playlist_songs | push: expected_song %}
    {% endif %}
  {% endfor %}
  
  {% comment %}
    3. Sort playlist songs by sequence if present
  {% endcomment %}
  {% assign sorted = playlist_songs | sort: "sequence" %}

  {% assign first_song = sorted | first %}

  <!-- ⭐ PLAYER FRAME WRAPPER (PURPLE THEME) ⭐ -->
  <div class="player-frame player-frame--purple">

    <!-- EMBED -->
    {% include embed.html youtube_id=first_song.youtube_id %}

    <!-- JS DATA -->
    <script>
      window.allSongs = {{ sorted | jsonify }};
    </script>

    <!-- CAROUSEL -->
    {% include carousel.html playlist=sorted %}

    <section class="song-about">
      <div class="centered-column">
        <h2 class="section-header">About the Song</h2>
        <div id="playlist-about" class="song-description"></div>
      </div>
    </section>

    <section class="song-lyrics">
      <div class="lyrics-block">
        <h2 class="section-header">Lyrics</h2>
        <div id="playlist-lyrics"></div>
      </div>
    </section>

  </div>
  <!-- ⭐ END PLAYER FRAME ⭐ -->

  <script>
  document.addEventListener("DOMContentLoaded", function () {
    const aboutEl = document.getElementById("playlist-about");
    const lyricsEl = document.getElementById("playlist-lyrics");
  
    // Load first song on page load
    const first = window.allSongs[0];
    if (first) {
      aboutEl.innerHTML = first.description || "";
      lyricsEl.innerHTML = first.lyrics || "";
    }
  
    // Update on tile click
    document.querySelectorAll(".carousel-tile").forEach(tile => {
      tile.addEventListener("click", () => {
        const id = tile.dataset.song;
        const song = window.allSongs.find(s => s.song_id === id);
        if (!song) return;
  
        aboutEl.innerHTML = song.description || "";
        lyricsEl.innerHTML = song.lyrics || "";
      });
    });
  });
  </script>
</main>
