{% if site.debug %}
<div class="debug-block">
<pre style="background:#222; color:#0f0; padding:1rem; margin:1rem 0; white-space:pre-wrap;">

CAROUSEL DEBUG
====================

mode:
{{ include.mode }}

public_only:
{{ include.public_only }}

current (active song):
{{ include.current | jsonify }}

songs (raw input list):
{{ include.songs | jsonify }}

</pre>
</div>
{% endif %}

{% for item in songs %}

  {%- comment -%}
  Normalize item â†’ always get:
  - song: the page from site.songs
  - meta: the entry from site.data.music.songs
  {%- endcomment -%}

  {% assign song = nil %}
  {% assign meta = nil %}
  {% assign url = nil %}

  {% if item.song_id %}
    {# item is a song object from site.songs #}
    {% assign song = item %}
    {% assign url = song.url %}
    {% assign meta = site.data.music.songs | where: "url", url | first %}
  {% elsif item.url %}
    {# item is a meta object from music.yml #}
    {% assign url = item.url %}
    {% assign meta = item %}
    {% assign song = site.songs | where: "url", url | first %}
  {% else %}
    {# item is a bare song_id string #}
    {% assign song = site.songs | where: "song_id", item | first %}
    {% if song %}
      {% assign url = song.url %}
      {% assign meta = site.data.music.songs | where: "url", url | first %}
    {% endif %}
  {% endif %}

  {% if not song or not meta %}
    {% continue %}
  {% endif %}

  {%- comment -%}
  Public-only filtering
  {%- endcomment -%}
  {% if public_only and meta.videostatus != "Public" %}
    {% continue %}
  {% endif %}

  {%- comment -%}
  Determine active tile
  {%- endcomment -%}
  {% assign is_active = false %}
  {% if current and current.song_id == song.song_id %}
    {% assign is_active = true %}
  {% endif %}

  <div class="playlist-tile {% if is_active %}active-tile{% endif %}"
       data-song="{{ song.song_id }}"
       data-url="{{ url }}">
    <img src="{{ meta.image }}" alt="{{ song.title }}">
    <h3 class="tile-title">{{ song.title }}</h3>
  </div>

{% endfor %}
