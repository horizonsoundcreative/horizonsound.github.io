---
layout: default
---

{% assign current_song = page %}

{%- comment -%}
LOOKUP META FROM music.yml
{%- endcomment -%}
{% assign url = current_song.url %}
{% assign meta = site.data.music.songs | where: "url", url | first %}

{%- comment -%}
BUILD PLAYLIST FOR CAROUSEL
{%- endcomment -%}
{% assign related = site.data.music.songs | where: "primary_playlist", meta.primary_playlist %}
{% assign related_public = related | where: "videostatus", "Public" %}
{% assign sorted_by_sequence = related_public | sort: "sequence" %}
{% assign first_item = sorted_by_sequence | first %}

{% if first_item.sequence %}
  {% assign playlist_sorted = sorted_by_sequence %}
{% else %}
  {% assign playlist_sorted = related_public | sort: "title" %}
{% endif %}

<main>

  {%- comment -%}
  DEBUG BLOCK â€” must be inside <main> so it renders
  {%- endcomment -%}

  <div class="debug-block">
  <pre style="background:#111; color:#0ff; padding:1rem; margin:1rem 0; white-space:pre-wrap;">

SONG PAGE DEBUG
====================

current_song:
{{ current_song | jsonify }}

meta:
{{ meta | jsonify }}

playlist_sorted:
{{ playlist_sorted | jsonify }}

  </pre>
  </div>

  <!-- SONG TITLE + SUBTITLE -->
  <section class="song-header">
    <h2 class="section-header">{{ current_song.title }}</h2>
    {% if current_song.subtitle %}
      <p class="song-subtitle">{{ current_song.subtitle }}</p>
    {% endif %}
  </section>

    <!-- EMBED -->
  <div id="playlist-player" class="playlist-player">
    <iframe
      id="playlist-iframe"
      width="100%"
      height="360"
      src="https://www.youtube.com/embed/{{ meta.youtube_id }}"
      frameborder="0"
      allowfullscreen>
    </iframe>
  </div>

  <!-- CAROUSEL -->
  {% if meta.primary_playlist %}
    {% include carousel.html 
         songs=playlist_sorted 
         current=current_song 
         public_only=true 
         mode="song" 
    %}
  {% endif %}

  <!-- ABOUT + LYRICS -->
  <div id="song-details" class="song-details">
    <h2 id="song-title">{{ current_song.title }}</h2>
    <p id="song-description">{{ current_song.about }}</p>
    <div id="song-lyrics">
      {{ current_song.lyrics | markdownify }}
    </div>
  </div>

</main>

