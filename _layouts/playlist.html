---
layout: default
---

{% comment %}
  1. Load the playlist entry from playlists.yml
{% endcomment %}
{% assign playlist = site.data.playlists | where: "playlist_id", page.playlist_id | first %}

<main class="playlist-page">
  <script>
    window.isPlaylistPage = true;
  </script>

  {% if site.debug %}
  <div class="debug-block">
    <pre style="background:#111; color:#0ff; padding:1rem; white-space:pre-wrap;">
PLAYLIST PAGE DEBUG
==============================

page.playlist_id: {{ page.playlist_id }}

PLAYLIST YAML ENTRY:
{{ playlist | jsonify }}

SONG IDS FROM PLAYLIST:
{{ playlist.songs | jsonify }}

    </pre>
  </div>
  {% endif %}

  <!-- PLAYLIST HEADER -->
  <section class="playlist-header">
    <h2 class="section-header">{{ playlist.title }}</h2>
    {% if playlist.description %}
      <p class="playlist-description">{{ playlist.description }}</p>
    {% endif %}
  </section>

  {% comment %}
    2. Build the list of songs for this playlist
  {% endcomment %}
  {% assign playlist_songs = "" | split: "" %}

  {% for sid in playlist.songs %}
    {% assign expected_song = site.data.music.songs | where: "song_id", sid | first %}
    {% if expected_song and expected_song.videostatus == "Public" %}
      {% assign playlist_songs = playlist_songs | push: expected_song %}
    {% endif %}
  {% endfor %}
  
  {% comment %}
    3. Sort playlist songs by sequence if present
  {% endcomment %}
  {% assign sorted = playlist_songs | sort: "sequence" %}

  {% assign first_song = sorted | first %}

  <!-- ⭐ PLAYER FRAME WRAPPER (PURPLE THEME) ⭐ -->
  <div class="player-frame player-frame--purple">

    <!-- EMBED -->
    {% include embed.html youtube_id=first_song.youtube_id %}

    <!-- JS DATA -->
    <script>
      window.allSongs = {{ sorted | jsonify }};
    </script>

    <!-- CAROUSEL -->
    {% include carousel.html playlist=sorted %}
  </div>

  <section class="playlist-about">
    <div class="centered-column">
      <h2 class="section-header">About the Song</h2>
      <div id="playlist-about" class="playlist-about-text"></div>
    </div>
  </section>

  <section class="playlist-lyrics">
    <div class="lyrics-block">
      <h2 class="section-header">Lyrics</h2>
      <div id="playlist-lyrics" class="playlist-lyrics-text"></div>
    </div>
  </section>

  <!-- ⭐ END PLAYER FRAME ⭐ -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      console.log("=== PLAYLIST INIT START ===");
    
      const aboutEl = document.getElementById("playlist-about");
      const lyricsEl = document.getElementById("playlist-lyrics");
      const iframe = document.querySelector(".video-wrapper iframe");
    
      console.log("aboutEl:", aboutEl);
      console.log("lyricsEl:", lyricsEl);
      console.log("iframe:", iframe);
      console.log("window.allSongs:", window.allSongs);
    
      if (!window.allSongs || !Array.isArray(window.allSongs) || window.allSongs.length === 0) {
        console.warn("window.allSongs is missing or empty.");
        return;
      }
    
      // ⭐ Load the first song on page load
      const first = window.allSongs[0];
      console.log("First song object:", first);
      console.log("First song keys:", Object.keys(first));
    
      if (first) {
        const initialDescription = first.description_html || "";
        const initialLyrics = first.lyrics_html || "";
    
        console.log("Setting initial About:", initialDescription);
        console.log("Setting initial Lyrics:", initialLyrics);
    
        if (aboutEl) aboutEl.innerHTML = initialDescription;
        if (lyricsEl) lyricsEl.innerHTML = initialLyrics;
    
        if (iframe && first.youtube_id) {
          const initialSrc = `https://www.youtube.com/embed/${first.youtube_id}`;
          console.log("Setting initial iframe src:", initialSrc);
          iframe.src = initialSrc;
        }
    
        const firstTileSelector = `.carousel-tile[data-song="${first.song_id}"]`;
        const firstTile = document.querySelector(firstTileSelector);
        console.log("First tile selector:", firstTileSelector);
        console.log("First tile element:", firstTile);
    
        if (firstTile) {
          firstTile.classList.add("active");
          console.log("Marked first tile as active.");
        } else {
          console.warn("Could not find first tile to mark active.");
        }
      } else {
        console.warn("No first song found in window.allSongs.");
      }
    
      // ⭐ Tile click handler
      const tiles = document.querySelectorAll(".carousel-tile");
      console.log("Found carousel tiles:", tiles);
    
      tiles.forEach(tile => {
        tile.addEventListener("click", () => {
          console.log("=== TILE CLICKED ===");
          console.log("Tile element:", tile);
          console.log("Tile dataset.song:", tile.dataset.song);
    
          const id = tile.dataset.song;
          const song = window.allSongs.find(s => s.song_id === id);
    
          console.log("Matched song for click:", song);
          console.log("Clicked song keys:", Object.keys(song));
    
          if (!song) {
            console.warn("NO SONG FOUND FOR ID:", id);
            return;
          }
    
          // Update video
          if (iframe && song.youtube_id) {
            const newSrc = `https://www.youtube.com/embed/${song.youtube_id}`;
            console.log("Updating iframe src to:", newSrc);
            iframe.src = newSrc;
          } else {
            console.warn("No iframe or youtube_id available for clicked song.");
          }
    
          // ⭐ Update About + Lyrics using new HTML fields
          const newDescription = song.description_html || "";
          const newLyrics = song.lyrics_html || "";
    
          console.log("Updating About to:", newDescription);
          console.log("Updating Lyrics to:", newLyrics);
    
          if (aboutEl) aboutEl.innerHTML = newDescription;
          if (lyricsEl) lyricsEl.innerHTML = newLyrics;
    
          // Update active tile
          tiles.forEach(t => t.classList.remove("active"));
          tile.classList.add("active");
          console.log("Active tile updated.");
        });
      });
    
      console.log("=== PLAYLIST INIT COMPLETE ===");
    });
  </script>
</main>
